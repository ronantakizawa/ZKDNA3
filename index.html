<!doctype html>
<html>
<head>
  <title>HLA Matching Zero-Knowledge Proof</title>
</head>
<body>

  <h1>HLA Matching Zero-Knowledge Proof</h1>

  <p>
    This Zero-Knowledge Proof (ZKP) demonstrates that a donor and recipient have at least a certain number of matching Human Leukocyte Antigen (HLA) markers, which is crucial for organ transplantation compatibility, without revealing any sensitive genetic information.
  </p>

  <h2>How HLA Matching for Organ Transplants Works</h2>

  <p>
    HLA markers are proteins found on the surface of cells that play a significant role in the immune system's ability to recognize foreign substances. In organ transplantation, matching HLA markers between donor and recipient reduces the risk of organ rejection. Typically, there are 10 key HLA markers, and a higher number of matches indicates better compatibility.
  </p>

  <h2>What the ZKP Proves</h2>

  <ul>
    <li>The donor and recipient have at least 7 matching HLA markers out of 10.</li>
    <li>No actual HLA marker values are revealed, preserving privacy.</li>
  </ul>

  <h2>Input Descriptions</h2>

  <ul>
    <li><strong>Donor's HLA Markers (<code>HLA_d</code>):</strong> An array of 10 integers representing the donor's HLA markers.</li>
    <li><strong>Recipient's HLA Markers (<code>HLA_r</code>):</strong> An array of 10 integers representing the recipient's HLA markers.</li>
  </ul>

  <h2>Instructions</h2>
  <p>
    Enter the donor's and recipient's HLA markers. Each list should contain exactly 10 integers separated by commas. The HLA markers are integers representing specific genetic markers.
  </p>

  <h3>Examples of Inputs That Work</h3>

  <p><strong>Example 1 (Passing Verification):</strong></p>
  <ul>
    <li>Donor's HLA Markers (<code>HLA_d</code>): <code>12,23,34,45,56,67,78,89,90,21</code></li>
    <li>Recipient's HLA Markers (<code>HLA_r</code>): <code>12,23,35,45,56,68,78,89,91,21</code></li>
  </ul>
  <p>This example results in 7 matching HLA markers, meeting the threshold.</p>

  <p><strong>Example 2 (Failing Verification):</strong></p>
  <ul>
    <li>Donor's HLA Markers (<code>HLA_d</code>): <code>10,20,30,40,50,60,70,80,90,100</code></li>
    <li>Recipient's HLA Markers (<code>HLA_r</code>): <code>11,21,31,41,51,61,71,81,91,101</code></li>
  </ul>
  <p>This example results in 0 matching HLA markers, failing to meet the threshold.</p>

  <p><strong>Example 3 (Passing Verification):</strong></p>
  <ul>
    <li>Donor's HLA Markers (<code>HLA_d</code>): <code>5,15,25,35,45,55,65,75,85,95</code></li>
    <li>Recipient's HLA Markers (<code>HLA_r</code>): <code>5,15,25,35,45,55,65,75,85,95</code></li>
  </ul>
  <p>This example results in 10 matching HLA markers, exceeding the threshold.</p>

  <hr>

  <!-- Input Fields -->
  <h3>Enter Your Data:</h3>

  <label for="HLA_d">Donor's HLA Markers (<code>HLA_d</code>):</label><br>
  <textarea id="HLA_d" rows="2" cols="60">12,23,34,45,56,67,78,89,90,21</textarea><br><br>

  <label for="HLA_r">Recipient's HLA Markers (<code>HLA_r</code>):</label><br>
  <textarea id="HLA_r" rows="2" cols="60">12,23,35,45,56,68,78,89,91,21</textarea><br><br>

  <button id="bGenProof">Create Proof</button>

  <!-- Output Sections -->
  <pre class="proof"><strong>Proof:</strong> <code id="proof"></code></pre>
  <pre class="proof"><strong>Result:</strong> <code id="result"></code></pre>
  <pre class="error"><strong>Error:</strong> <code id="error"></code></pre>

  <!-- Include snarkjs library -->
  <script src="snarkjs.min.js"></script>

  <script>
    const proofComponent = document.getElementById('proof');
    const resultComponent = document.getElementById('result');
    const errorComponent = document.getElementById('error');
    const bGenProof = document.getElementById("bGenProof");

    bGenProof.addEventListener("click", calculateProof);

    async function calculateProof() {
      // Clear previous output
      proofComponent.innerHTML = "";
      resultComponent.innerHTML = "";
      errorComponent.innerHTML = "";

      try {
        // Get user inputs
        const HLA_d = document.getElementById('HLA_d').value.split(',').map(Number);
        const HLA_r = document.getElementById('HLA_r').value.split(',').map(Number);

        // Input validation
        if (HLA_d.length !== 10 || HLA_r.length !== 10) {
          throw new Error("HLA_d and HLA_r must each have exactly 10 values.");
        }

        // Prepare input object
        const input = {
          HLA_d,
          HLA_r
        };

        // Generate proof
        const { proof, publicSignals } = await snarkjs.groth16.fullProve(
          input,
          "circuit.wasm",
          "circuit_final.zkey"
        );

        // Display proof
        proofComponent.innerHTML = JSON.stringify(proof, null, 2);

        // Fetch and parse verification key
        const vkey = await fetch("verification_key.json").then(res => res.json());

        // Verify proof
        const isValid = await snarkjs.groth16.verify(vkey, publicSignals, proof);

        resultComponent.innerHTML = isValid ? "Proof is valid. Verification OK." : "Proof is invalid. Verification Failed.";

      } catch (error) {
        // Display error
        errorComponent.innerHTML = error.message || "An unknown error occurred.";
        console.error(error);
      }
    }
  </script>

</body>
</html>
